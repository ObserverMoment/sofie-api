// https://github.com/prisma/prisma2
// SDL first example: https://github.com/prisma/prisma-examples/tree/prisma2/javascript/graphql-sdl-first
// Migrations: https://github.com/prisma/migrate
generator client {
  provider = "prisma-client-js"
}

// url      = env("DATABASE_URL")
datasource db {
  provider = "postgresql"
  url      = "postgres://vksegplfohzkfb:4006286c49b2ccada42a32cc56f0405ae370152bd9e594d3f38b5d1f34cebadb@ec2-79-125-26-232.eu-west-1.compute.amazonaws.com:5432/dfj0e91erhbqs1"
}

model Benchmark {
  id               String          @default(uuid()) @id
  createdAt        DateTime        @default(now())
  completedOn      DateTime
  level            Level
  score            Int
  note             String?
  user             User            @relation(fields: [userId], references: [id])
  userId           String
  challenge        Challenge?      @relation(fields: [challengeId], references: [id])
  challengeId      String?
  benchmarkVideo   BenchmarkVideo? @relation(fields: [benchmarkVideoId], references: [id])
  benchmarkVideoId String?
}

model BenchmarkVideo {
  id                        String                     @default(uuid()) @id
  createdAt                 DateTime                   @default(now())
  videoUrl                  String
  note                      String?
  benchmark                 Benchmark
  benchmarkId               String
  benchmarkVideoValidations BenchmarkVideoValidation[]
}

model BenchmarkVideoValidation {
  id                    String                @default(uuid()) @id
  createdAt             DateTime              @default(now())
  createdByUser         User                  @relation(fields: [createdByUserId], references: [id])
  createdByUserId       String
  isValid               Boolean
  benchmarkVideo        BenchmarkVideo        @relation(fields: [benchmarkVideoId], references: [id])
  benchmarkVideoId      String
  benchmarkVideoComment BenchmarkVideoComment
}

model BenchmarkVideoComment {
  id                         String                         @default(uuid()) @id
  createdAt                  DateTime                       @default(now())
  createdByUser              User                           @relation(fields: [createdByUserId], references: [id])
  createdByUserId            String
  benchmarkVideoValidation   BenchmarkVideoValidation?      @relation(fields: [benchmarkVideoValidationId], references: [id])
  benchmarkVideoValidationId String?
  comment                    String
  replies                    BenchmarkVideoCommentReplies[]
}

model BenchmarkVideoCommentReplies {
  id                      String                @default(uuid()) @id
  createdAt               DateTime              @default(now())
  createdByUser           User                  @relation(fields: [createdByUserId], references: [id])
  createdByUserId         String
  comment                 String
  benchmarkVideoComment   BenchmarkVideoComment @relation(fields: [benchmarkVideoCommentId], references: [id])
  benchmarkVideoCommentId String
}

model Challenge {
  id          String          @default(uuid()) @id
  createdAt   DateTime        @default(now())
  scope       AccessScopeType @default(PRIVATE)
  name        String          @unique
  category    String?
  description String?
  imageUrl    String?
  group       Group           @relation(fields: [groupId], references: [id])
  groupId     String
  user        User            @relation(fields: [userId], references: [id])
  userId      String
  workout     Workout[]       @relation(references: [id])
  benchmarks  Benchmark[]
  watchers    User[]          @relation("watchersToChallenges", references: [id])
}

model Group {
  id          String          @default(uuid()) @id
  scope       AccessScopeType @default(PRIVATE)
  logoUrl     String?
  name        String          @unique
  countryCode String?
  description String?
  users       User[]          @relation(references: [id])
  challenges  Challenge[]
}

model Move {
  id           String          @default(uuid()) @id
  scope        AccessScopeType @default(PRIVATE)
  name         String          @unique
  description  String?
  demoVideoUrl String?
  workoutMoves WorkoutMove[]
}

model WorkoutMove {
  id                  String  @default(uuid()) @id
  beginnerScaling     String?
  intermediateScaling String?
  prescribedScaling   String?
  repsPerRound        Int?
  move                Move    @relation(fields: [moveId], references: [id])
  moveId              String
  workout             Workout @relation(fields: [workoutId], references: [id])
  workoutId           String
}

model Workout {
  id           String          @default(uuid()) @id
  name         String          @unique
  category     WodCategory
  scope        AccessScopeType @default(PRIVATE)
  summary      String?
  description  String?
  workoutType  WorkoutType
  workoutMoves WorkoutMove[]
  worldRecords WorldRecord[]
  challenges   Challenge[]     @relation(references: [id])
}

model WorldRecord {
  id          String     @default(uuid()) @id
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  notes       String?
  recordValue Int
  recordType  RecordType
  gender      Gender
  workout     Workout    @relation(fields: [workoutId], references: [id])
  workoutId   String
  user        User?      @relation(fields: [userId], references: [id])
  userId      String?
}

// Height in cms / weight in kgs
model User {
  id                           String                         @default(uuid()) @id
  firebaseUid                  String                         @unique
  createdAt                    DateTime                       @default(now())
  hasOnboarded                 Boolean                        @default(false)
  avatarUrl                    String?
  displayName                  String?                        @unique
  firstname                    String?
  lastname                     String?
  bio                          String?
  birthdate                    DateTime?
  gender                       Gender?
  height                       Float?
  weight                       Float?
  gymBox                       String?
  townCity                     String?
  countryCode                  String?
  unitSystem                   UnitSystem                     @default(METRIC)
  benchmarks                   Benchmark[]
  groups                       Group[]
  worldRecords                 WorldRecord[]
  challenges                   Challenge[]
  benchmarkVideoValidations    BenchmarkVideoValidation[]
  benchmarkVideoComments       BenchmarkVideoComment[]
  BenchmarkVideoCommentReplies BenchmarkVideoCommentReplies[]
  watchedChallenges            Challenge[]                    @relation("watchersToChallenges", references: [id])
  followers                    UserConnection[]               @relation("followee")
  following                    UserConnection[]               @relation("follower")
}

// Need to check if the below names are the correct way around
// What actually happens (what query is made) when you run User.followers with @relation("followee")?
// Does it get all UserConnections where followeeId = user.id?
// If so then this is probably the correct way around...
// As it would be all the instances where the user is the followee.
// https://github.com/prisma/prisma/issues/1483
model UserConnection {
  id         String   @default(uuid()) @id
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  follower   User     @relation("follower", fields: [followerId], references: [id])
  followerId String
  followee   User?    @relation("followee", fields: [followeeId], references: [id])
  followeeId String?
}

// Enums
enum AccessScopeType {
  OFFICIAL
  PUBLIC
  GROUP
  PRIVATE
}

enum Gender {
  MALE
  FEMALE
  UNSPECIFIED
}

enum Level {
  BEGINNER
  INTERMEDIATE
  ELITE
}

// AMRAP in reps
// TIME in seconds
// LOAD in lbs
enum RecordType {
  AMRAP
  FORTIME
  FORLOAD
}

// https://beyondthewhiteboard.com/gyms/2-main-site/leader_boards/414
enum WodCategory {
  GIRLS
  HEROES
  NOTABLES
}

enum WorkoutType {
  AMRAP
  FORTIME
  FORLOAD
}

enum UnitSystem {
  IMPERIAL
  METRIC
}