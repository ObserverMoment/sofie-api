# Migration `20200514182104-user-to-group-relations`

This migration has been generated by ObserverMoment at 5/14/2020, 6:21:04 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "public"."_group_admin" (
"A" text  NOT NULL ,"B" text  NOT NULL )

CREATE TABLE "public"."_group_member" (
"A" text  NOT NULL ,"B" text  NOT NULL )

ALTER TABLE "public"."Challenge" ALTER COLUMN "scope" SET DEFAULT 'PRIVATE';

ALTER TABLE "public"."Group" ADD COLUMN "createdById" text  NOT NULL ,
ALTER COLUMN "scope" SET DEFAULT 'PRIVATE';

ALTER TABLE "public"."Move" ALTER COLUMN "scope" SET DEFAULT 'PRIVATE';

ALTER TABLE "public"."User" ALTER COLUMN "unitSystem" SET DEFAULT 'METRIC';

ALTER TABLE "public"."Workout" ALTER COLUMN "scope" SET DEFAULT 'PRIVATE';

ALTER TABLE "public"."_GroupToUser" DROP CONSTRAINT IF EXiSTS "_GroupToUser_A_fkey";

ALTER TABLE "public"."_GroupToUser" DROP CONSTRAINT IF EXiSTS "_GroupToUser_B_fkey";

CREATE UNIQUE INDEX "_group_admin_AB_unique" ON "public"."_group_admin"("A","B")

CREATE  INDEX "_group_admin_B_index" ON "public"."_group_admin"("B")

CREATE UNIQUE INDEX "_group_member_AB_unique" ON "public"."_group_member"("A","B")

CREATE  INDEX "_group_member_B_index" ON "public"."_group_member"("B")

ALTER TABLE "public"."_group_admin" ADD FOREIGN KEY ("A")REFERENCES "public"."Group"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_group_admin" ADD FOREIGN KEY ("B")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_group_member" ADD FOREIGN KEY ("A")REFERENCES "public"."Group"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_group_member" ADD FOREIGN KEY ("B")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Group" ADD FOREIGN KEY ("createdById")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

DROP TABLE "public"."_GroupToUser";
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200513182524-reset..20200514182104-user-to-group-relations
--- datamodel.dml
+++ datamodel.dml
@@ -4,12 +4,12 @@
 generator client {
   provider = "prisma-client-js"
 }
-// url = "***"
+// url      = env("DATABASE_URL")
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url      = "postgres://vksegplfohzkfb:4006286c49b2ccada42a32cc56f0405ae370152bd9e594d3f38b5d1f34cebadb@ec2-79-125-26-232.eu-west-1.compute.amazonaws.com:5432/dfj0e91erhbqs1"
 }
 model Benchmark {
   id               String          @default(uuid()) @id
@@ -91,9 +91,12 @@
   logoUrl     String?
   name        String          @unique
   countryCode String?
   description String?
-  users       User[]          @relation(references: [id])
+  createdBy   User            @relation("group_creator", fields: [createdById], references: [id])
+  createdById String
+  admins      User[]          @relation("group_admin", references: [id])
+  members     User[]          @relation("group_member", references: [id])
   challenges  Challenge[]
 }
 model Move {
@@ -163,17 +166,19 @@
   townCity                     String?
   countryCode                  String?
   unitSystem                   UnitSystem                     @default(METRIC)
   benchmarks                   Benchmark[]
-  groups                       Group[]
   worldRecords                 WorldRecord[]
   challenges                   Challenge[]
   benchmarkVideoValidations    BenchmarkVideoValidation[]
   benchmarkVideoComments       BenchmarkVideoComment[]
   BenchmarkVideoCommentReplies BenchmarkVideoCommentReplies[]
   watchedChallenges            Challenge[]                    @relation("watchersToChallenges", references: [id])
   followers                    UserConnection[]               @relation("followee")
   following                    UserConnection[]               @relation("follower")
+  groupsWhereAdmin             Group[]                        @relation("group_admin")
+  groupsWhereMember            Group[]                        @relation("group_member")
+  groupsWhereCreator           Group[]                        @relation("group_creator")
 }
 // Need to check if the below names are the correct way around
 // What actually happens (what query is made) when you run User.followers with @relation("followee")?
```


