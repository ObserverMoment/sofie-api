# Migration `20200526163831-move-available-equipments`

This migration has been generated by ObserverMoment at 5/26/2020, 4:38:31 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "WorkoutScoreType_new" AS ENUM ('AMREPS', 'AMROUNDS', 'EMOM', 'FORTIME', 'FORLOAD');
ALTER TABLE "public"."Workout" ALTER COLUMN "workoutScoreType" DROP DEFAULT,
                        ALTER COLUMN "workoutScoreType" TYPE "WorkoutScoreType_new" USING ("workoutScoreType"::text::"WorkoutScoreType_new"),
                        ALTER COLUMN "workoutScoreType" SET DEFAULT 'AMREPS';
ALTER TABLE "public"."WorldRecord" ALTER COLUMN "workoutScoreType" DROP DEFAULT,
                        ALTER COLUMN "workoutScoreType" TYPE "WorkoutScoreType_new" USING ("workoutScoreType"::text::"WorkoutScoreType_new"),
                        ALTER COLUMN "workoutScoreType" SET DEFAULT 'AMREPS';
ALTER TYPE "WorkoutScoreType" RENAME TO "WorkoutScoreType_old";
ALTER TYPE "WorkoutScoreType_new" RENAME TO "WorkoutScoreType";
DROP TYPE "WorkoutScoreType_old"

CREATE TABLE "public"."_EquipmentToMove" (
"A" text  NOT NULL ,"B" text  NOT NULL )

ALTER TABLE "public"."Challenge" ALTER COLUMN "scope" SET DEFAULT 'PRIVATE';

ALTER TABLE "public"."Group" ALTER COLUMN "scope" SET DEFAULT 'PRIVATE';

ALTER TABLE "public"."Move" DROP CONSTRAINT IF EXiSTS "Move_equipmentId_fkey",
DROP COLUMN "equipmentId",
ALTER COLUMN "scope" SET DEFAULT 'PRIVATE';

ALTER TABLE "public"."User" ALTER COLUMN "subscriptionLevel" SET DEFAULT 'FREE',
ALTER COLUMN "unitSystem" SET DEFAULT 'METRIC';

ALTER TABLE "public"."Workout" ALTER COLUMN "difficultyLevel" SET DEFAULT 'ONE',
ALTER COLUMN "scope" SET DEFAULT 'PRIVATE',
ALTER COLUMN "workoutScoreType" SET DEFAULT 'AMREPS';

ALTER TABLE "public"."WorkoutMove" ADD COLUMN "selectedEquipmentId" text  NOT NULL ,
ALTER COLUMN "repType" SET DEFAULT 'REPS';

ALTER TABLE "public"."WorldRecord" ALTER COLUMN "workoutScoreType" SET DEFAULT 'AMREPS';

CREATE UNIQUE INDEX "_EquipmentToMove_AB_unique" ON "public"."_EquipmentToMove"("A","B")

CREATE  INDEX "_EquipmentToMove_B_index" ON "public"."_EquipmentToMove"("B")

ALTER TABLE "public"."_EquipmentToMove" ADD FOREIGN KEY ("A")REFERENCES "public"."Equipment"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_EquipmentToMove" ADD FOREIGN KEY ("B")REFERENCES "public"."Move"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."WorkoutMove" ADD FOREIGN KEY ("selectedEquipmentId")REFERENCES "public"."Equipment"("id") ON DELETE CASCADE  ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200522153740-workout-section-is-pyramid..20200526163831-move-available-equipments
--- datamodel.dml
+++ datamodel.dml
@@ -6,9 +6,9 @@
 }
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url      = env("DATABASE_URL")
 }
 model Benchmark {
   id               String          @default(uuid()) @id
@@ -99,26 +99,26 @@
   challenges  Challenge[]
 }
 model Equipment {
-  id       String  @default(uuid()) @id
-  name     String
-  imageUrl String?
-  moves    Move[]
+  id          String        @default(uuid()) @id
+  name        String
+  imageUrl    String?
+  moves       Move[]        @relation(references: [id])
+  WorkoutMove WorkoutMove[]
 }
 model Move {
-  id           String          @default(uuid()) @id
-  createdAt    DateTime        @default(now())
-  createdBy    User?           @relation(fields: [createdById], references: [id])
-  createdById  String?
-  scope        AccessScopeType @default(PRIVATE)
-  name         String          @unique
-  description  String?
-  demoVideoUrl String?
-  equipment    Equipment?      @relation(fields: [equipmentId], references: [id])
-  equipmentId  String?
-  workoutMoves WorkoutMove[]
+  id                  String          @default(uuid()) @id
+  createdAt           DateTime        @default(now())
+  createdBy           User?           @relation(fields: [createdById], references: [id])
+  createdById         String?
+  scope               AccessScopeType @default(PRIVATE)
+  name                String          @unique
+  description         String?
+  demoVideoUrl        String?
+  availableEquipments Equipment[]     @relation(references: [id])
+  workoutMoves        WorkoutMove[]
 }
 model WorkoutMove {
   id                  String             @default(uuid()) @id
@@ -130,8 +130,10 @@
   maleLoadAmountKgs   Float?
   femaleLoadAmountKgs Float?
   move                Move               @relation(fields: [moveId], references: [id])
   moveId              String
+  selectedEquipment   Equipment          @relation(fields: [selectedEquipmentId], references: [id])
+  selectedEquipmentId String
   workoutSection      WorkoutSection     @relation(fields: [workoutSectionId], references: [id])
   workoutSectionId    String
 }
@@ -304,9 +306,8 @@
 enum WorkoutScoreType {
   AMREPS
   AMROUNDS
   EMOM
-  FORDISTANCE
   FORTIME
   FORLOAD
 }
```


