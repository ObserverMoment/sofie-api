# Migration `20200518154142-reset`

This migration has been generated by ObserverMoment at 5/18/2020, 3:41:42 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE "public"."Challenge" ALTER COLUMN "scope" SET DEFAULT 'PRIVATE';

ALTER TABLE "public"."Group" ALTER COLUMN "scope" SET DEFAULT 'PRIVATE';

ALTER TABLE "public"."Move" ALTER COLUMN "scope" SET DEFAULT 'PRIVATE';

ALTER TABLE "public"."User" ALTER COLUMN "subscriptionLevel" SET DEFAULT 'FREE',
ALTER COLUMN "unitSystem" SET DEFAULT 'METRIC';

ALTER TABLE "public"."Workout" ALTER COLUMN "difficultyLevel" SET DEFAULT 'ONE',
ALTER COLUMN "scope" SET DEFAULT 'PRIVATE',
ALTER COLUMN "workoutScoreType" SET DEFAULT 'AMREPS';

ALTER TABLE "public"."WorkoutMove" DROP COLUMN "repsPerRound",
ADD COLUMN "reps" integer   ;

ALTER TABLE "public"."WorldRecord" ALTER COLUMN "workoutScoreType" SET DEFAULT 'AMREPS';
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20200518154142-reset
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,285 @@
+// https://github.com/prisma/prisma2
+// SDL first example: https://github.com/prisma/prisma-examples/tree/prisma2/javascript/graphql-sdl-first
+// Migrations: https://github.com/prisma/migrate
+generator client {
+  provider = "prisma-client-js"
+}
+
+// url      = "postgres://vksegplfohzkfb:4006286c49b2ccada42a32cc56f0405ae370152bd9e594d3f38b5d1f34cebadb@ec2-79-125-26-232.eu-west-1.compute.amazonaws.com:5432/dfj0e91erhbqs1"
+datasource db {
+  provider = "postgresql"
+  url      = env("DATABASE_URL")
+}
+
+model Benchmark {
+  id               String          @default(uuid()) @id
+  createdAt        DateTime        @default(now())
+  completedOn      DateTime
+  score            Int
+  note             String?
+  completedBy      User            @relation(fields: [completedById], references: [id])
+  completedById    String
+  challenge        Challenge?      @relation(fields: [challengeId], references: [id])
+  challengeId      String?
+  benchmarkVideo   BenchmarkVideo? @relation(fields: [benchmarkVideoId], references: [id])
+  benchmarkVideoId String?
+}
+
+model BenchmarkVideo {
+  id                        String                     @default(uuid()) @id
+  createdAt                 DateTime                   @default(now())
+  videoUrl                  String
+  note                      String?
+  benchmark                 Benchmark
+  benchmarkId               String
+  benchmarkVideoValidations BenchmarkVideoValidation[]
+}
+
+model BenchmarkVideoValidation {
+  id                    String                @default(uuid()) @id
+  createdAt             DateTime              @default(now())
+  createdByUser         User                  @relation(fields: [createdByUserId], references: [id])
+  createdByUserId       String
+  isValid               Boolean
+  benchmarkVideo        BenchmarkVideo        @relation(fields: [benchmarkVideoId], references: [id])
+  benchmarkVideoId      String
+  benchmarkVideoComment BenchmarkVideoComment
+}
+
+model BenchmarkVideoComment {
+  id                         String                         @default(uuid()) @id
+  createdAt                  DateTime                       @default(now())
+  createdByUser              User                           @relation(fields: [createdByUserId], references: [id])
+  createdByUserId            String
+  benchmarkVideoValidation   BenchmarkVideoValidation?      @relation(fields: [benchmarkVideoValidationId], references: [id])
+  benchmarkVideoValidationId String?
+  comment                    String
+  replies                    BenchmarkVideoCommentReplies[]
+}
+
+model BenchmarkVideoCommentReplies {
+  id                      String                @default(uuid()) @id
+  createdAt               DateTime              @default(now())
+  createdByUser           User                  @relation(fields: [createdByUserId], references: [id])
+  createdByUserId         String
+  comment                 String
+  benchmarkVideoComment   BenchmarkVideoComment @relation(fields: [benchmarkVideoCommentId], references: [id])
+  benchmarkVideoCommentId String
+}
+
+model Challenge {
+  id          String          @default(uuid()) @id
+  createdAt   DateTime        @default(now())
+  scope       AccessScopeType @default(PRIVATE)
+  name        String          @unique
+  category    String?
+  description String?
+  imageUrl    String?
+  group       Group           @relation(fields: [groupId], references: [id])
+  groupId     String
+  createdBy   User            @relation(fields: [createdById], references: [id])
+  createdById String
+  workouts    Workout[]       @relation(references: [id])
+  benchmarks  Benchmark[]
+  watchers    User[]          @relation("watchersToChallenges", references: [id])
+}
+
+model Group {
+  id          String          @default(uuid()) @id
+  scope       AccessScopeType @default(PRIVATE)
+  logoUrl     String?
+  name        String          @unique
+  countryCode String?
+  description String?
+  createdBy   User            @relation("group_creator", fields: [createdById], references: [id])
+  createdById String
+  admins      User[]          @relation("group_admin", references: [id])
+  members     User[]          @relation("group_member", references: [id])
+  challenges  Challenge[]
+}
+
+model Move {
+  id           String          @default(uuid()) @id
+  createdAt    DateTime        @default(now())
+  createdBy    User?           @relation(fields: [createdById], references: [id])
+  createdById  String?
+  scope        AccessScopeType @default(PRIVATE)
+  name         String          @unique
+  description  String?
+  demoVideoUrl String?
+  equipment    Equipment?      @relation(fields: [equipmentId], references: [id])
+  equipmentId  String?
+  workoutMoves WorkoutMove[]
+}
+
+model WorkoutMove {
+  id                  String   @default(uuid()) @id
+  createdAt           DateTime @default(now())
+  createdBy           User?    @relation(fields: [createdById], references: [id])
+  createdById         String?
+  reps                Int?
+  maleLoadAmountKgs   Float?
+  femaleLoadAmountKgs Float?
+  move                Move     @relation(fields: [moveId], references: [id])
+  moveId              String
+  workout             Workout  @relation(fields: [workoutId], references: [id])
+  workoutId           String
+}
+
+model Equipment {
+  id       String  @default(uuid()) @id
+  name     String
+  imageUrl String?
+  moves    Move[]
+}
+
+model Workout {
+  id                  String               @default(uuid()) @id
+  createdAt           DateTime             @default(now())
+  createdBy           User?                @relation(fields: [createdById], references: [id])
+  createdById         String?
+  name                String               @unique
+  summary             String?
+  description         String?
+  difficultyLevel     DifficultyLevel      @default(ONE)
+  scope               AccessScopeType      @default(PRIVATE)
+  crossfitWodCategory CrossfitWodCategory?
+  workoutScoreType    WorkoutScoreType     @default(AMREPS)
+  workoutMoves        WorkoutMove[]
+  worldRecords        WorldRecord[]
+  challenges          Challenge[]          @relation(references: [id])
+  scheduledWorkouts   ScheduledWorkout[]
+}
+
+model ScheduledWorkout {
+  id          String   @default(uuid()) @id
+  createdAt   DateTime @default(now())
+  createdBy   User     @relation(fields: [createdById], references: [id])
+  createdById String
+  notes       String?
+  scheduledAt DateTime @default(now())
+  completed   Boolean  @default(false)
+  workout     Workout  @relation(fields: [workoutId], references: [id])
+  workoutId   String
+}
+
+model WorldRecord {
+  id               String           @default(uuid()) @id
+  createdAt        DateTime         @default(now())
+  updatedAt        DateTime         @updatedAt
+  notes            String?
+  recordValue      Int
+  workoutScoreType WorkoutScoreType @default(AMREPS)
+  gender           Gender
+  workout          Workout          @relation(fields: [workoutId], references: [id])
+  workoutId        String
+  user             User?            @relation(fields: [userId], references: [id])
+  userId           String?
+}
+
+// Height in cms / weight in kgs
+model User {
+  id                           String                         @default(uuid()) @id
+  firebaseUid                  String                         @unique
+  createdAt                    DateTime                       @default(now())
+  hasOnboarded                 Boolean                        @default(false)
+  avatarUrl                    String?
+  displayName                  String?                        @unique
+  firstname                    String?
+  lastname                     String?
+  bio                          String?
+  birthdate                    DateTime?
+  gender                       Gender?
+  height                       Float?
+  weight                       Float?
+  gymBox                       String?
+  townCity                     String?
+  countryCode                  String?
+  unitSystem                   UnitSystem                     @default(METRIC)
+  subscriptionLevel            UserSubscriptionLevel          @default(FREE)
+  benchmarks                   Benchmark[]
+  worldRecords                 WorldRecord[]
+  challenges                   Challenge[]
+  benchmarkVideoValidations    BenchmarkVideoValidation[]
+  benchmarkVideoComments       BenchmarkVideoComment[]
+  BenchmarkVideoCommentReplies BenchmarkVideoCommentReplies[]
+  watchedChallenges            Challenge[]                    @relation("watchersToChallenges", references: [id])
+  followers                    UserConnection[]               @relation("followee")
+  following                    UserConnection[]               @relation("follower")
+  groupsWhereAdmin             Group[]                        @relation("group_admin")
+  groupsWhereMember            Group[]                        @relation("group_member")
+  groupsWhereCreator           Group[]                        @relation("group_creator")
+  moves                        Move[]
+  workoutMoves                 WorkoutMove[]
+  workouts                     Workout[]
+  scheduledWorkouts            ScheduledWorkout[]
+}
+
+// Need to check if the below names are the correct way around
+// What actually happens (what query is made) when you run User.followers with @relation("followee")?
+// Does it get all UserConnections where followeeId = user.id?
+// If so then this is probably the correct way around...
+// As it would be all the instances where the user is the followee.
+// https://github.com/prisma/prisma/issues/1483
+model UserConnection {
+  id         String   @default(uuid()) @id
+  createdAt  DateTime @default(now())
+  updatedAt  DateTime @updatedAt
+  follower   User     @relation("follower", fields: [followerId], references: [id])
+  followerId String
+  followee   User?    @relation("followee", fields: [followeeId], references: [id])
+  followeeId String?
+}
+
+// Enums
+enum AccessScopeType {
+  OFFICIAL
+  PUBLIC
+  GROUP
+  PRIVATE
+}
+
+enum UserSubscriptionLevel {
+  FREE
+  PAID
+}
+
+enum Gender {
+  MALE
+  FEMALE
+  UNSPECIFIED
+}
+
+enum DifficultyLevel {
+  ONE
+  TWO
+  THREE
+  FOUR
+}
+
+// AMREPS in reps
+// AMROUNDS in rounds
+// TIME in seconds
+// LOAD in kgs
+// EMON in rounds completed (if doing standard EMON then this unit value is minutes)
+// Also used for: Every 5 miniutes on the 5 minutes etc - free text in description?
+enum WorkoutScoreType {
+  AMREPS
+  AMROUNDS
+  EMOM
+  FORDISTANCE
+  FORTIME
+  FORLOAD
+}
+
+// https://beyondthewhiteboard.com/gyms/2-main-site/leader_boards/414
+enum CrossfitWodCategory {
+  GIRLS
+  HEROES
+  NOTABLES
+}
+
+enum UnitSystem {
+  IMPERIAL
+  METRIC
+}
```


