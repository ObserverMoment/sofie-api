# Migration `20200702112017-user-follows-cleanup-workout-demo-video-thumb-url`

This migration has been generated by ObserverMoment at 7/2/2020, 11:20:17 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "public"."_UserFollows" (
"A" text  NOT NULL ,"B" text  NOT NULL )

ALTER TABLE "public"."Workout" ADD COLUMN "demoVideoThumbUrl" text   ;

ALTER TABLE "public"."UserConnection" DROP CONSTRAINT IF EXiSTS "UserConnection_followeeId_fkey";

ALTER TABLE "public"."UserConnection" DROP CONSTRAINT IF EXiSTS "UserConnection_followerId_fkey";

CREATE UNIQUE INDEX "_UserFollows_AB_unique" ON "public"."_UserFollows"("A","B")

CREATE  INDEX "_UserFollows_B_index" ON "public"."_UserFollows"("B")

ALTER TABLE "public"."_UserFollows" ADD FOREIGN KEY ("A")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_UserFollows" ADD FOREIGN KEY ("B")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

DROP TABLE "public"."UserConnection";
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200629221509-workout-image-url..20200702112017-user-follows-cleanup-workout-demo-video-thumb-url
--- datamodel.dml
+++ datamodel.dml
@@ -6,9 +6,9 @@
 }
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 model Benchmark {
   id               String          @default(uuid()) @id
@@ -170,8 +170,9 @@
   name              String
   summary           String?
   description       String?
   demoVideoUrl      String?
+  demoVideoThumbUrl String?
   imageUrl          String?
   timecap           Int?
   difficultyLevel   DifficultyLevel    @default(ONE)
   scope             AccessScopeType    @default(PRIVATE)
@@ -235,34 +236,18 @@
   benchmarkVideoValidations    BenchmarkVideoValidation[]
   benchmarkVideoComments       BenchmarkVideoComment[]
   BenchmarkVideoCommentReplies BenchmarkVideoCommentReplies[]
   watchedChallenges            Challenge[]                    @relation("watchersToChallenges", references: [id])
-  followers                    UserConnection[]               @relation("followee")
-  following                    UserConnection[]               @relation("follower")
+  followedBy                   User[]                         @relation("UserFollows", references: [id])
+  following                    User[]                         @relation("UserFollows", references: [id])
   groupsWhereAdmin             Group[]                        @relation("groupToAdmins")
   groupsWhereMember            Group[]                        @relation("groupToMembers")
   groupsWhereCreator           Group[]                        @relation("groupToCreator")
   moves                        Move[]
   workouts                     Workout[]
   scheduledWorkouts            ScheduledWorkout[]
 }
-// Need to check if the below names are the correct way around
-// What actually happens (what query is made) when you run User.followers with @relation("followee")?
-// Does it get all UserConnections where followeeId = user.id?
-// If so then this is probably the correct way around...
-// As it would be all the instances where the user is the followee.
-// https://github.com/prisma/prisma/issues/1483
-model UserConnection {
-  id         String   @default(uuid()) @id
-  createdAt  DateTime @default(now())
-  updatedAt  DateTime @updatedAt
-  follower   User     @relation("follower", fields: [followerId], references: [id])
-  followerId String
-  followee   User?    @relation("followee", fields: [followeeId], references: [id])
-  followeeId String?
-}
-
 // Enums
 enum AccessScopeType {
   OFFICIAL
   PUBLIC
```


