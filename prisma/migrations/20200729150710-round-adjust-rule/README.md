# Migration `20200729150710-round-adjust-rule`

This migration has been generated by ObserverMoment at 7/29/2020, 3:07:10 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "RuleOperator" AS ENUM ('INCREASE', 'DECREASE');

CREATE TABLE "public"."RoundAdjustRule" (
"id" text  NOT NULL ,
"name" text  NOT NULL ,
"description" text   ,
"operator" "RuleOperator" NOT NULL ,
"amount" integer  NOT NULL ,
"roundFrequency" integer  NOT NULL DEFAULT 1,
PRIMARY KEY ("id"))

ALTER TABLE "public"."WorkoutSection" ADD COLUMN "repAdjustRuleId" text   ,
ADD COLUMN "loadAdjustRuleId" text   ;

ALTER TABLE "public"."WorkoutSection" ADD FOREIGN KEY ("repAdjustRuleId")REFERENCES "public"."RoundAdjustRule"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."WorkoutSection" ADD FOREIGN KEY ("loadAdjustRuleId")REFERENCES "public"."RoundAdjustRule"("id") ON DELETE SET NULL ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200728214831-workout-section-name-to-notes..20200729150710-round-adjust-rule
--- datamodel.dml
+++ datamodel.dml
@@ -6,9 +6,9 @@
 }
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 model ScoreSubmission {
   id                     String                @default(uuid()) @id
@@ -151,23 +151,45 @@
   workoutSectionId    String
 }
 model WorkoutSection {
-  id                     String        @default(uuid()) @id
-  createdAt              DateTime      @default(now())
+  id                     String           @default(uuid()) @id
+  createdAt              DateTime         @default(now())
   sortPosition           Int
   notes                  String?
-  repPyramid             Boolean       @default(false)
+  repPyramid             Boolean          @default(false)
   repPyramidStructure    Int[]
-  weightPyramid          Boolean       @default(false)
+  weightPyramid          Boolean          @default(false)
   weightPyramidStructure Int[]
   timecap                Int?
-  rounds                 Int           @default(1)
-  workout                Workout       @relation(fields: [workoutId], references: [id])
+  rounds                 Int              @default(1)
+  repAdjustRule          RoundAdjustRule? @relation("repAdjustRule", fields: [repAdjustRuleId], references: [id])
+  repAdjustRuleId        String?
+  loadAdjustRule         RoundAdjustRule? @relation("loadAdjustRule", fields: [loadAdjustRuleId], references: [id])
+  loadAdjustRuleId       String?
+  workout                Workout          @relation(fields: [workoutId], references: [id])
   workoutId              String
   workoutMoves           WorkoutMove[]
 }
+// Every {roundFrequency} rounds {operator} reps by {amount}
+// Eg. Every 3 rounds INCREASE reps by 10 (for all workout moves within the section)
+model RoundAdjustRule {
+  id             String           @default(uuid()) @id
+  name           String
+  description    String?
+  operator       RuleOperator
+  amount         Int
+  roundFrequency Int              @default(1) // Every round
+  repAdjusted    WorkoutSection[] @relation("repAdjustRule")
+  loadAdjusted   WorkoutSection[] @relation("loadAdjustRule")
+}
+
+enum RuleOperator {
+  INCREASE
+  DECREASE
+}
+
 model Workout {
   id                String             @default(uuid()) @id
   createdAt         DateTime           @default(now())
   createdBy         User?              @relation(fields: [createdById], references: [id])
```


