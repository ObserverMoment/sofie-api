# Migration `20200810132723-logged-workout-changes`

This migration has been generated by ObserverMoment at 8/10/2020, 2:27:23 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE "public"."ScoreSubmission" DROP CONSTRAINT "ScoreSubmission_loggedWorkoutId_fkey"

ALTER TABLE "public"."LoggedWorkout" ALTER COLUMN "completedOn" DROP DEFAULT;

ALTER TABLE "public"."ScoreSubmission" DROP COLUMN "loggedWorkoutId";
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200810105019-logged-workout-original-workout-id..20200810132723-logged-workout-changes
--- datamodel.dml
+++ datamodel.dml
@@ -6,9 +6,9 @@
 }
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 model ScoreSubmission {
   id                     String                @default(uuid()) @id
@@ -20,10 +20,8 @@
   challenge              Challenge?            @relation(fields: [challengeId], references: [id])
   challengeId            String?
   scoreSubmissionVideo   ScoreSubmissionVideo? @relation(fields: [scoreSubmissionVideoId], references: [id])
   scoreSubmissionVideoId String?
-  loggedWorkout          LoggedWorkout         @relation(fields: [loggedWorkoutId], references: [id])
-  loggedWorkoutId        String
 }
 model ScoreSubmissionVideo {
   id                              String                           @default(uuid()) @id
@@ -139,29 +137,29 @@
   Workout     Workout[]
 }
 model Workout {
-  id                String             @default(uuid()) @id
-  createdAt         DateTime           @default(now())
-  createdBy         User?              @relation(fields: [createdById], references: [id])
-  createdById       String?
-  name              String
-  summary           String?
-  description       String?
-  demoVideoUrl      String?
-  demoVideoThumbUrl String?
-  youtubeVideoUrl   String?
-  spotifyAudio      String?
-  imageUrl          String?
-  timecap           Int?
-  difficultyLevel   DifficultyLevel    @default(ONE)
-  scope             AccessScopeType    @default(PRIVATE)
-  workoutType       WorkoutType        @relation(fields: [workoutTypeId], references: [id])
-  workoutTypeId     String
-  workoutSections   WorkoutSection[]
-  scheduledWorkouts ScheduledWorkout[]
-  loggedWorkouts    LoggedWorkout[]
-  LoggedWorkout     LoggedWorkout[]    @relation("workoutData")
+  id                     String             @default(uuid()) @id
+  createdAt              DateTime           @default(now())
+  createdBy              User?              @relation(fields: [createdById], references: [id])
+  createdById            String?
+  name                   String
+  summary                String?
+  description            String?
+  demoVideoUrl           String?
+  demoVideoThumbUrl      String?
+  youtubeVideoUrl        String?
+  spotifyAudio           String?
+  imageUrl               String?
+  timecap                Int?
+  difficultyLevel        DifficultyLevel    @default(ONE)
+  scope                  AccessScopeType    @default(PRIVATE)
+  workoutType            WorkoutType        @relation(fields: [workoutTypeId], references: [id])
+  workoutTypeId          String
+  workoutSections        WorkoutSection[]
+  scheduledWorkouts      ScheduledWorkout[]
+  workoutDataForLogs     LoggedWorkout[]    @relation("workoutDataForLogs")
+  originalWorkoutForLogs LoggedWorkout[]
 }
 model WorkoutSection {
   id               String            @default(uuid()) @id
@@ -234,21 +232,20 @@
 // Data from a completed workout. Also inlcudes relation to the 'original' workout
 model LoggedWorkout {
   id                 String            @default(uuid()) @id
   createdAt          DateTime          @default(now())
-  completedOn        DateTime          @default(now())
+  completedOn        DateTime
   completedBy        User              @relation(fields: [completedById], references: [id])
   completedById      String
   notes              String?
   videoUrl           String?
   imageUrl           String?
-  workoutData        Workout           @relation("workoutData", fields: [workoutDataId], references: [id])
+  workoutData        Workout           @relation("workoutDataForLogs", fields: [workoutDataId], references: [id])
   workoutDataId      String
   originalWorkout    Workout?          @relation(fields: [originalWorkoutId], references: [id])
   originalWorkoutId  String?
   scheduledWorkout   ScheduledWorkout?
   scheduledWorkoutId String?
-  scoreSubmissions   ScoreSubmission[]
 }
 // Height in cms / weight in kgs
 model User {
```


