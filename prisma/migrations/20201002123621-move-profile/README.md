# Migration `20201002123621-move-profile`

This migration has been generated by ObserverMoment at 10/2/2020, 1:36:21 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE "public"."_compoundMoves" DROP CONSTRAINT "_compoundMoves_A_fkey"

ALTER TABLE "public"."_compoundMoves" DROP CONSTRAINT "_compoundMoves_B_fkey"

ALTER TABLE "public"."Equipment" ADD COLUMN "gymProfileId" text   

ALTER TABLE "public"."Move" DROP COLUMN "moveType"

DROP TYPE "MoveType"

CREATE TABLE "public"."MoveProfile" (
"id" text   NOT NULL ,
"userId" text   NOT NULL ,
"name" text   NOT NULL ,
"description" text   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."_requiredMoves" (
"A" text   NOT NULL ,
"B" text   NOT NULL 
)

CREATE TABLE "public"."_excludedMoves" (
"A" text   NOT NULL ,
"B" text   NOT NULL 
)

CREATE UNIQUE INDEX "_requiredMoves_AB_unique" ON "public"."_requiredMoves"("A", "B")

CREATE INDEX "_requiredMoves_B_index" ON "public"."_requiredMoves"("B")

CREATE UNIQUE INDEX "_excludedMoves_AB_unique" ON "public"."_excludedMoves"("A", "B")

CREATE INDEX "_excludedMoves_B_index" ON "public"."_excludedMoves"("B")

ALTER TABLE "public"."MoveProfile" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_requiredMoves" ADD FOREIGN KEY ("A")REFERENCES "public"."Move"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_requiredMoves" ADD FOREIGN KEY ("B")REFERENCES "public"."MoveProfile"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_excludedMoves" ADD FOREIGN KEY ("A")REFERENCES "public"."Move"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_excludedMoves" ADD FOREIGN KEY ("B")REFERENCES "public"."MoveProfile"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Equipment" ADD FOREIGN KEY ("gymProfileId")REFERENCES "public"."GymProfile"("id") ON DELETE SET NULL ON UPDATE CASCADE

DROP TABLE "public"."_compoundMoves"
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200929120847-difficulty-level-now-integer..20201002123621-move-profile
--- datamodel.dml
+++ datamodel.dml
@@ -6,9 +6,9 @@
 }
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 // model ScoreSubmission {
 //   id                     String                @default(uuid()) @id
@@ -102,56 +102,68 @@
 //   challenges  Challenge[]
 // }
 model Equipment {
-  id                 String        @default(uuid()) @id
+  id                 String        @id @default(uuid())
   name               String        @unique
   imageUrl           String?
   requiredForMoves   Move[]        @relation("moveToRequiredEquipments", references: [id])
   selectableForMoves Move[]        @relation("moveToSelectableEquipments", references: [id])
   WorkoutMove        WorkoutMove[]
+  GymProfile         GymProfile?   @relation(fields: [gymProfileId], references: [id])
+  gymProfileId       String?
 }
 model Move {
-  id                   String               @default(uuid()) @id
+  id                   String               @id @default(uuid())
   createdAt            DateTime             @default(now())
   createdBy            User?                @relation(fields: [createdById], references: [id])
   createdById          String?
   scope                AccessScopeType      @default(PRIVATE)
   name                 String               @unique
   description          String?
   demoVideoUrl         String?
-  moveType             MoveType             @default(STANDARD)
-  compoundMoveParents  Move[]               @relation("compoundMoves", references: [id])
-  compoundMoveChildren Move[]               @relation("compoundMoves", references: [id])
   validRepTypes        WorkoutMoveRepType[]
   requiredEquipments   Equipment[]          @relation("moveToRequiredEquipments", references: [id])
   selectableEquipments Equipment[]          @relation("moveToSelectableEquipments", references: [id])
+  moveProfileRequired  MoveProfile[]        @relation("requiredMoves", references: [id])
+  moveProfileExcluded  MoveProfile[]        @relation("excludedMoves", references: [id])
   workoutMoves         WorkoutMove[]
 }
 model WorkoutType {
-  id            String           @default(uuid()) @id
+  id            String           @id @default(uuid())
   name          String
   description   String?
   scoreType     WorkoutScoreType
   Workout       Workout[]
   LoggedWorkout LoggedWorkout[]
 }
 model GymProfile {
-  id                String             @default(uuid()) @id
-  user              User               @relation(fields: [userId], references: [id])
-  userId            String
-  name              String
-  description       String?
-  postcode          String?
-  scheduledWorkouts ScheduledWorkout[]
-  loggedWorkouts    LoggedWorkout[]
+  id                  String             @id @default(uuid())
+  user                User               @relation(fields: [userId], references: [id])
+  userId              String
+  name                String
+  description         String?
+  postcode            String?
+  availableEquipments Equipment[]
+  scheduledWorkouts   ScheduledWorkout[]
+  loggedWorkouts      LoggedWorkout[]
 }
+model MoveProfile {
+  id            String  @id @default(uuid())
+  user          User    @relation(fields: [userId], references: [id])
+  userId        String
+  name          String
+  description   String?
+  requiredMoves Move[]  @relation("requiredMoves", references: [id])
+  excludedMoves Move[]  @relation("excludedMoves", references: [id])
+}
+
 model Workout {
-  id                String             @default(uuid()) @id
+  id                String             @id @default(uuid())
   createdAt         DateTime           @default(now())
   createdBy         User?              @relation(fields: [createdById], references: [id])
   createdById       String?
   name              String
@@ -176,9 +188,9 @@
   likes             LikedWorkout[]
 }
 model ScheduledWorkout {
-  id              String         @default(uuid()) @id
+  id              String         @id @default(uuid())
   createdAt       DateTime       @default(now())
   user            User           @relation(fields: [userId], references: [id])
   userId          String
   notes           String?
@@ -197,17 +209,18 @@
   userId    String
   notes     String?
   workout   Workout  @relation(fields: [workoutId], references: [id])
   workoutId String
+  // likedworkoutTags LikedWorkoutTag[]
+
   @@id([userId, workoutId])
-  // likedworkoutTags LikedWorkoutTag[]
 }
 // Need to implement some more solid polymorphism here if we want to allow a workoutSection
 // to be on a workout or a loggedWorkout
 // Currently no validation makinhg sure the section is not parentless.
 model WorkoutSection {
-  id               String            @default(uuid()) @id
+  id               String            @id @default(uuid())
   createdAt        DateTime          @default(now())
   sortPosition     Int
   notes            String?
   timecap          Int?
@@ -224,9 +237,9 @@
 // Every {roundFrequency} rounds {operator} reps by {amount}
 // Eg. Every 3 rounds INCREASE reps by 10 (for all workout moves within the section)
 model RoundAdjustRule {
-  id               String         @default(uuid()) @id
+  id               String         @id @default(uuid())
   action           RuleAction
   target           RuleTarget
   amount           Float
   roundFrequency   Int            @default(1) // Every round
@@ -245,9 +258,9 @@
   LOAD
 }
 model WorkoutMove {
-  id                  String             @default(uuid()) @id
+  id                  String             @id @default(uuid())
   createdAt           DateTime           @default(now())
   sortPosition        Int
   repType             WorkoutMoveRepType @default(REPS)
   reps                Float?             @default(10)
@@ -267,9 +280,9 @@
 }
 // Data from a completed workout. Also inlcudes relation to the 'original' workout
 model LoggedWorkout {
-  id                   String            @default(uuid()) @id
+  id                   String            @id @default(uuid())
   name                 String
   summary              String?
   description          String?
   createdAt            DateTime          @default(now())
@@ -295,9 +308,9 @@
 }
 // Height in cms / weight in kgs
 model User {
-  id                String             @default(uuid()) @id
+  id                String             @id @default(uuid())
   firebaseUid       String             @unique
   createdAt         DateTime           @default(now())
   hasOnboarded      Boolean?           @default(false)
   avatarUrl         String?
@@ -329,8 +342,9 @@
   scheduledWorkouts ScheduledWorkout[]
   loggedWorkouts    LoggedWorkout[]
   likedWorkouts     LikedWorkout[]
   gymProfiles       GymProfile[]
+  MoveProfile       MoveProfile[]
 }
 // Enums
 enum AccessScopeType {
@@ -339,13 +353,8 @@
   PAID
   PRIVATE
 }
-enum MoveType {
-  STANDARD
-  COMPOUND
-}
-
 enum Gender {
   MALE
   FEMALE
   UNSPECIFIED
```


