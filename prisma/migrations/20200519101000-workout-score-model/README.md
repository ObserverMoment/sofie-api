# Migration `20200519101000-workout-score-model`

This migration has been generated by ObserverMoment at 5/19/2020, 10:10:00 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "public"."WorkoutScore" (
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"id" text  NOT NULL ,"notes" text   ,"score" integer  NOT NULL ,
    PRIMARY KEY ("id"))

ALTER TABLE "public"."Benchmark" DROP COLUMN "score",
ADD COLUMN "workoutScoreId" text  NOT NULL ;

ALTER TABLE "public"."Challenge" ALTER COLUMN "scope" SET DEFAULT 'PRIVATE';

ALTER TABLE "public"."Group" ALTER COLUMN "scope" SET DEFAULT 'PRIVATE';

ALTER TABLE "public"."Move" ALTER COLUMN "scope" SET DEFAULT 'PRIVATE';

ALTER TABLE "public"."ScheduledWorkout" ADD COLUMN "workoutScoreId" text  NOT NULL ;

ALTER TABLE "public"."User" ALTER COLUMN "subscriptionLevel" SET DEFAULT 'FREE',
ALTER COLUMN "unitSystem" SET DEFAULT 'METRIC';

ALTER TABLE "public"."Workout" ALTER COLUMN "difficultyLevel" SET DEFAULT 'ONE',
ALTER COLUMN "scope" SET DEFAULT 'PRIVATE',
ALTER COLUMN "workoutScoreType" SET DEFAULT 'AMREPS';

ALTER TABLE "public"."WorldRecord" ALTER COLUMN "workoutScoreType" SET DEFAULT 'AMREPS';

CREATE UNIQUE INDEX "Benchmark_workoutScoreId" ON "public"."Benchmark"("workoutScoreId")

CREATE UNIQUE INDEX "ScheduledWorkout_workoutScoreId" ON "public"."ScheduledWorkout"("workoutScoreId")

ALTER TABLE "public"."Benchmark" ADD FOREIGN KEY ("workoutScoreId")REFERENCES "public"."WorkoutScore"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."ScheduledWorkout" ADD FOREIGN KEY ("workoutScoreId")REFERENCES "public"."WorkoutScore"("id") ON DELETE CASCADE  ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200518170619-optional-challenge-to-scheduled-workout..20200519101000-workout-score-model
--- datamodel.dml
+++ datamodel.dml
@@ -4,26 +4,26 @@
 generator client {
   provider = "prisma-client-js"
 }
-// url = "***"
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url      = env("DATABASE_URL")
 }
 model Benchmark {
   id               String          @default(uuid()) @id
   createdAt        DateTime        @default(now())
   completedOn      DateTime
-  score            Int
   note             String?
   completedBy      User            @relation(fields: [completedById], references: [id])
   completedById    String
   challenge        Challenge?      @relation(fields: [challengeId], references: [id])
   challengeId      String?
   benchmarkVideo   BenchmarkVideo? @relation(fields: [benchmarkVideoId], references: [id])
   benchmarkVideoId String?
+  workoutScore     WorkoutScore    @relation(fields: [workoutScoreId], references: [id])
+  workoutScoreId   String
 }
 model BenchmarkVideo {
   id                        String                     @default(uuid()) @id
@@ -152,21 +152,32 @@
   scheduledWorkouts   ScheduledWorkout[]
 }
 model ScheduledWorkout {
-  id          String     @default(uuid()) @id
-  createdAt   DateTime   @default(now())
-  createdBy   User       @relation(fields: [createdById], references: [id])
-  createdById String
-  notes       String?
-  scheduledAt DateTime   @default(now())
-  completed   Boolean    @default(false)
-  workout     Workout    @relation(fields: [workoutId], references: [id])
-  workoutId   String
-  challenge   Challenge? @relation(fields: [challengeId], references: [id])
-  challengeId String?
+  id             String       @default(uuid()) @id
+  createdAt      DateTime     @default(now())
+  createdBy      User         @relation(fields: [createdById], references: [id])
+  createdById    String
+  notes          String?
+  scheduledAt    DateTime     @default(now())
+  completed      Boolean      @default(false)
+  workout        Workout      @relation(fields: [workoutId], references: [id])
+  workoutId      String
+  workoutScore   WorkoutScore @relation(fields: [workoutScoreId], references: [id])
+  workoutScoreId String
+  challenge      Challenge?   @relation(fields: [challengeId], references: [id])
+  challengeId    String?
 }
+model WorkoutScore {
+  id               String           @default(uuid()) @id
+  createdAt        DateTime         @default(now())
+  score            Int
+  notes            String?
+  scheduledWorkout ScheduledWorkout
+  benchmark        Benchmark?
+}
+
 model WorldRecord {
   id               String           @default(uuid()) @id
   createdAt        DateTime         @default(now())
   updatedAt        DateTime         @updatedAt
```


