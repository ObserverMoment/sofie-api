# Migration `20200520173051-workout-section-model`

This migration has been generated by ObserverMoment at 5/20/2020, 5:30:51 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "WorkoutMoveRepType" AS ENUM ('REPS', 'CALORIES', 'METRES', 'SECONDS');

CREATE TABLE "public"."WorkoutSection" (
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"id" text  NOT NULL ,"name" text   ,"rounds" integer  NOT NULL DEFAULT 1,"sortPosition" integer   ,"timeCapSeconds" integer   ,"workoutId" text  NOT NULL ,
    PRIMARY KEY ("id"))

ALTER TABLE "public"."Challenge" ALTER COLUMN "scope" SET DEFAULT 'PRIVATE';

ALTER TABLE "public"."Group" ALTER COLUMN "scope" SET DEFAULT 'PRIVATE';

ALTER TABLE "public"."Move" ALTER COLUMN "scope" SET DEFAULT 'PRIVATE';

ALTER TABLE "public"."User" ALTER COLUMN "subscriptionLevel" SET DEFAULT 'FREE',
ALTER COLUMN "unitSystem" SET DEFAULT 'METRIC';

ALTER TABLE "public"."Workout" ALTER COLUMN "difficultyLevel" SET DEFAULT 'ONE',
ALTER COLUMN "scope" SET DEFAULT 'PRIVATE',
ALTER COLUMN "workoutScoreType" SET DEFAULT 'AMREPS';

ALTER TABLE "public"."WorkoutMove" DROP CONSTRAINT IF EXiSTS "WorkoutMove_workoutId_fkey",
DROP COLUMN "reps",
ADD COLUMN "femaleReps" integer   ,
ADD COLUMN "maleReps" integer   ,
ADD COLUMN "repType" "WorkoutMoveRepType" NOT NULL DEFAULT 'REPS',
ADD COLUMN "sortPosition" integer   ,
ADD COLUMN "workoutSectionId" text  NOT NULL ,
ALTER COLUMN "workoutId" DROP NOT NULL;

ALTER TABLE "public"."WorldRecord" ALTER COLUMN "workoutScoreType" SET DEFAULT 'AMREPS';

ALTER TABLE "public"."WorkoutSection" ADD FOREIGN KEY ("workoutId")REFERENCES "public"."Workout"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."WorkoutMove" ADD FOREIGN KEY ("workoutSectionId")REFERENCES "public"."WorkoutSection"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."WorkoutMove" ADD FOREIGN KEY ("workoutId")REFERENCES "public"."Workout"("id") ON DELETE SET NULL  ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200519103531-workout-move-remove-user..20200520173051-workout-section-model
--- datamodel.dml
+++ datamodel.dml
@@ -6,9 +6,9 @@
 }
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url      = env("DATABASE_URL")
 }
 model Benchmark {
   id               String          @default(uuid()) @id
@@ -98,8 +98,15 @@
   members     User[]          @relation("group_member", references: [id])
   challenges  Challenge[]
 }
+model Equipment {
+  id       String  @default(uuid()) @id
+  name     String
+  imageUrl String?
+  moves    Move[]
+}
+
 model Move {
   id           String          @default(uuid()) @id
   createdAt    DateTime        @default(now())
   createdBy    User?           @relation(fields: [createdById], references: [id])
@@ -113,24 +120,34 @@
   workoutMoves WorkoutMove[]
 }
 model WorkoutMove {
-  id                  String   @default(uuid()) @id
-  createdAt           DateTime @default(now())
-  reps                Int?
+  id                  String             @default(uuid()) @id
+  createdAt           DateTime           @default(now())
+  sortPosition        Int?
+  repType             WorkoutMoveRepType @default(REPS)
+  maleReps            Int?
+  femaleReps          Int?
   maleLoadAmountKgs   Float?
   femaleLoadAmountKgs Float?
-  move                Move     @relation(fields: [moveId], references: [id])
+  move                Move               @relation(fields: [moveId], references: [id])
   moveId              String
-  workout             Workout  @relation(fields: [workoutId], references: [id])
-  workoutId           String
+  workoutSection      WorkoutSection     @relation(fields: [workoutSectionId], references: [id])
+  workoutSectionId    String
+  Workout             Workout?           @relation(fields: [workoutId], references: [id])
+  workoutId           String?
 }
-model Equipment {
-  id       String  @default(uuid()) @id
-  name     String
-  imageUrl String?
-  moves    Move[]
+model WorkoutSection {
+  id             String        @default(uuid()) @id
+  createdAt      DateTime      @default(now())
+  sortPosition   Int?
+  name           String?
+  timeCapSeconds Int?
+  rounds         Int           @default(1)
+  workout        Workout       @relation(fields: [workoutId], references: [id])
+  workoutId      String
+  WorkoutMove    WorkoutMove[]
 }
 model Workout {
   id                  String               @default(uuid()) @id
@@ -143,12 +160,13 @@
   difficultyLevel     DifficultyLevel      @default(ONE)
   scope               AccessScopeType      @default(PRIVATE)
   crossfitWodCategory CrossfitWodCategory?
   workoutScoreType    WorkoutScoreType     @default(AMREPS)
-  workoutMoves        WorkoutMove[]
   worldRecords        WorldRecord[]
   challenges          Challenge[]          @relation(references: [id])
   scheduledWorkouts   ScheduledWorkout[]
+  WorkoutSection      WorkoutSection[]
+  WorkoutMove         WorkoutMove[]
 }
 model ScheduledWorkout {
   id             String       @default(uuid()) @id
@@ -270,8 +288,15 @@
   THREE
   FOUR
 }
+enum WorkoutMoveRepType {
+  REPS
+  CALORIES
+  METRES
+  SECONDS
+}
+
 // AMREPS in reps
 // AMROUNDS in rounds
 // TIME in seconds
 // LOAD in kgs
```


