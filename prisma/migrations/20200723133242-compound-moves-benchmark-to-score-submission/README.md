# Migration `20200723133242-compound-moves-benchmark-to-score-submission`

This migration has been generated by ObserverMoment at 7/23/2020, 1:32:42 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "MoveType" AS ENUM ('STANDARD', 'COMPOUND');

ALTER TABLE "public"."Benchmark" DROP CONSTRAINT "Benchmark_benchmarkVideoId_fkey"

ALTER TABLE "public"."Benchmark" DROP CONSTRAINT "Benchmark_challengeId_fkey"

ALTER TABLE "public"."Benchmark" DROP CONSTRAINT "Benchmark_completedById_fkey"

ALTER TABLE "public"."Benchmark" DROP CONSTRAINT "Benchmark_workoutScoreId_fkey"

ALTER TABLE "public"."BenchmarkVideoComment" DROP CONSTRAINT "BenchmarkVideoComment_benchmarkVideoValidationId_fkey"

ALTER TABLE "public"."BenchmarkVideoComment" DROP CONSTRAINT "BenchmarkVideoComment_createdByUserId_fkey"

ALTER TABLE "public"."BenchmarkVideoCommentReplies" DROP CONSTRAINT "BenchmarkVideoCommentReplies_benchmarkVideoCommentId_fkey"

ALTER TABLE "public"."BenchmarkVideoCommentReplies" DROP CONSTRAINT "BenchmarkVideoCommentReplies_createdByUserId_fkey"

ALTER TABLE "public"."BenchmarkVideoValidation" DROP CONSTRAINT "BenchmarkVideoValidation_benchmarkVideoId_fkey"

ALTER TABLE "public"."BenchmarkVideoValidation" DROP CONSTRAINT "BenchmarkVideoValidation_createdByUserId_fkey"

CREATE TABLE "public"."ScoreSubmission" (
"id" text  NOT NULL ,
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"completedOn" timestamp(3)  NOT NULL ,
"note" text   ,
"completedById" text  NOT NULL ,
"challengeId" text   ,
"scoreSubmissionVideoId" text   ,
"workoutScoreId" text  NOT NULL ,
PRIMARY KEY ("id"))

CREATE TABLE "public"."ScoreSubmissionVideo" (
"id" text  NOT NULL ,
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"videoUrl" text  NOT NULL ,
"note" text   ,
"scoreSubmissionId" text  NOT NULL ,
PRIMARY KEY ("id"))

CREATE TABLE "public"."ScoreSubmissionVideoValidation" (
"id" text  NOT NULL ,
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"createdByUserId" text  NOT NULL ,
"isValid" boolean  NOT NULL ,
"scoreSubmissionVideoId" text  NOT NULL ,
PRIMARY KEY ("id"))

CREATE TABLE "public"."ScoreSubmissionVideoComment" (
"id" text  NOT NULL ,
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"createdByUserId" text  NOT NULL ,
"scoreSubmissionVideoValidationId" text   ,
"comment" text  NOT NULL ,
PRIMARY KEY ("id"))

CREATE TABLE "public"."ScoreSubmissionVideoCommentReplies" (
"id" text  NOT NULL ,
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"createdByUserId" text  NOT NULL ,
"comment" text  NOT NULL ,
"scoreSubmissionVideoCommentId" text  NOT NULL ,
PRIMARY KEY ("id"))

CREATE TABLE "public"."_compoundMoves" (
"A" text  NOT NULL ,
"B" text  NOT NULL )

ALTER TABLE "public"."Move" ADD COLUMN "moveType" "MoveType" NOT NULL DEFAULT E'STANDARD';

CREATE UNIQUE INDEX "ScoreSubmission_scoreSubmissionVideoId" ON "public"."ScoreSubmission"("scoreSubmissionVideoId")

CREATE UNIQUE INDEX "ScoreSubmission_workoutScoreId" ON "public"."ScoreSubmission"("workoutScoreId")

CREATE UNIQUE INDEX "ScoreSubmissionVideoComment_scoreSubmissionVideoValidationId" ON "public"."ScoreSubmissionVideoComment"("scoreSubmissionVideoValidationId")

CREATE UNIQUE INDEX "_compoundMoves_AB_unique" ON "public"."_compoundMoves"("A","B")

CREATE  INDEX "_compoundMoves_B_index" ON "public"."_compoundMoves"("B")

ALTER TABLE "public"."ScoreSubmission" ADD FOREIGN KEY ("completedById")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."ScoreSubmission" ADD FOREIGN KEY ("challengeId")REFERENCES "public"."Challenge"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."ScoreSubmission" ADD FOREIGN KEY ("scoreSubmissionVideoId")REFERENCES "public"."ScoreSubmissionVideo"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."ScoreSubmission" ADD FOREIGN KEY ("workoutScoreId")REFERENCES "public"."WorkoutScore"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."ScoreSubmissionVideoValidation" ADD FOREIGN KEY ("createdByUserId")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."ScoreSubmissionVideoValidation" ADD FOREIGN KEY ("scoreSubmissionVideoId")REFERENCES "public"."ScoreSubmissionVideo"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."ScoreSubmissionVideoComment" ADD FOREIGN KEY ("createdByUserId")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."ScoreSubmissionVideoComment" ADD FOREIGN KEY ("scoreSubmissionVideoValidationId")REFERENCES "public"."ScoreSubmissionVideoValidation"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."ScoreSubmissionVideoCommentReplies" ADD FOREIGN KEY ("createdByUserId")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."ScoreSubmissionVideoCommentReplies" ADD FOREIGN KEY ("scoreSubmissionVideoCommentId")REFERENCES "public"."ScoreSubmissionVideoComment"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_compoundMoves" ADD FOREIGN KEY ("A")REFERENCES "public"."Move"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_compoundMoves" ADD FOREIGN KEY ("B")REFERENCES "public"."Move"("id") ON DELETE CASCADE ON UPDATE CASCADE

DROP TABLE "public"."Benchmark";

DROP TABLE "public"."BenchmarkVideo";

DROP TABLE "public"."BenchmarkVideoComment";

DROP TABLE "public"."BenchmarkVideoCommentReplies";

DROP TABLE "public"."BenchmarkVideoValidation";
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200723092709-workout-type..20200723133242-compound-moves-benchmark-to-score-submission
--- datamodel.dml
+++ datamodel.dml
@@ -6,66 +6,66 @@
 }
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
-model Benchmark {
-  id               String          @default(uuid()) @id
-  createdAt        DateTime        @default(now())
-  completedOn      DateTime
-  note             String?
-  completedBy      User            @relation(fields: [completedById], references: [id])
-  completedById    String
-  challenge        Challenge?      @relation(fields: [challengeId], references: [id])
-  challengeId      String?
-  benchmarkVideo   BenchmarkVideo? @relation(fields: [benchmarkVideoId], references: [id])
-  benchmarkVideoId String?
-  workoutScore     WorkoutScore    @relation(fields: [workoutScoreId], references: [id])
-  workoutScoreId   String
+model ScoreSubmission {
+  id                     String                @default(uuid()) @id
+  createdAt              DateTime              @default(now())
+  completedOn            DateTime
+  note                   String?
+  completedBy            User                  @relation(fields: [completedById], references: [id])
+  completedById          String
+  challenge              Challenge?            @relation(fields: [challengeId], references: [id])
+  challengeId            String?
+  scoreSubmissionVideo   ScoreSubmissionVideo? @relation(fields: [scoreSubmissionVideoId], references: [id])
+  scoreSubmissionVideoId String?
+  workoutScore           WorkoutScore          @relation(fields: [workoutScoreId], references: [id])
+  workoutScoreId         String
 }
-model BenchmarkVideo {
-  id                        String                     @default(uuid()) @id
-  createdAt                 DateTime                   @default(now())
-  videoUrl                  String
-  note                      String?
-  benchmark                 Benchmark
-  benchmarkId               String
-  benchmarkVideoValidations BenchmarkVideoValidation[]
+model ScoreSubmissionVideo {
+  id                              String                           @default(uuid()) @id
+  createdAt                       DateTime                         @default(now())
+  videoUrl                        String
+  note                            String?
+  scoreSubmission                 ScoreSubmission
+  scoreSubmissionId               String
+  scoreSubmissionVideoValidations ScoreSubmissionVideoValidation[]
 }
-model BenchmarkVideoValidation {
-  id                    String                @default(uuid()) @id
-  createdAt             DateTime              @default(now())
-  createdByUser         User                  @relation(fields: [createdByUserId], references: [id])
-  createdByUserId       String
-  isValid               Boolean
-  benchmarkVideo        BenchmarkVideo        @relation(fields: [benchmarkVideoId], references: [id])
-  benchmarkVideoId      String
-  benchmarkVideoComment BenchmarkVideoComment
+model ScoreSubmissionVideoValidation {
+  id                          String                      @default(uuid()) @id
+  createdAt                   DateTime                    @default(now())
+  createdByUser               User                        @relation(fields: [createdByUserId], references: [id])
+  createdByUserId             String
+  isValid                     Boolean
+  scoreSubmissionVideo        ScoreSubmissionVideo        @relation(fields: [scoreSubmissionVideoId], references: [id])
+  scoreSubmissionVideoId      String
+  scoreSubmissionVideoComment ScoreSubmissionVideoComment
 }
-model BenchmarkVideoComment {
-  id                         String                         @default(uuid()) @id
-  createdAt                  DateTime                       @default(now())
-  createdByUser              User                           @relation(fields: [createdByUserId], references: [id])
-  createdByUserId            String
-  benchmarkVideoValidation   BenchmarkVideoValidation?      @relation(fields: [benchmarkVideoValidationId], references: [id])
-  benchmarkVideoValidationId String?
-  comment                    String
-  replies                    BenchmarkVideoCommentReplies[]
+model ScoreSubmissionVideoComment {
+  id                               String                               @default(uuid()) @id
+  createdAt                        DateTime                             @default(now())
+  createdByUser                    User                                 @relation(fields: [createdByUserId], references: [id])
+  createdByUserId                  String
+  scoreSubmissionVideoValidation   ScoreSubmissionVideoValidation?      @relation(fields: [scoreSubmissionVideoValidationId], references: [id])
+  scoreSubmissionVideoValidationId String?
+  comment                          String
+  replies                          ScoreSubmissionVideoCommentReplies[]
 }
-model BenchmarkVideoCommentReplies {
-  id                      String                @default(uuid()) @id
-  createdAt               DateTime              @default(now())
-  createdByUser           User                  @relation(fields: [createdByUserId], references: [id])
-  createdByUserId         String
-  comment                 String
-  benchmarkVideoComment   BenchmarkVideoComment @relation(fields: [benchmarkVideoCommentId], references: [id])
-  benchmarkVideoCommentId String
+model ScoreSubmissionVideoCommentReplies {
+  id                            String                      @default(uuid()) @id
+  createdAt                     DateTime                    @default(now())
+  createdByUser                 User                        @relation(fields: [createdByUserId], references: [id])
+  createdByUserId               String
+  comment                       String
+  scoreSubmissionVideoComment   ScoreSubmissionVideoComment @relation(fields: [scoreSubmissionVideoCommentId], references: [id])
+  scoreSubmissionVideoCommentId String
 }
 model Challenge {
   id               String             @default(uuid()) @id
@@ -86,9 +86,9 @@
   groupId          String
   createdBy        User               @relation(fields: [createdById], references: [id])
   createdById      String
   workouts         Workout[]          @relation(references: [id])
-  benchmarks       Benchmark[]
+  scoreSubmissions ScoreSubmission[]
   watchers         User[]             @relation("watchersToChallenges", references: [id])
   scheduledWorkout ScheduledWorkout[]
 }
@@ -123,8 +123,11 @@
   scope                AccessScopeType      @default(PRIVATE)
   name                 String               @unique
   description          String?
   demoVideoUrl         String?
+  moveType             MoveType             @default(STANDARD)
+  compoundMoveParents  Move[]               @relation("compoundMoves", references: [id])
+  compoundMoveChildren Move[]               @relation("compoundMoves", references: [id])
   validRepTypes        WorkoutMoveRepType[]
   requiredEquipments   Equipment[]          @relation("moveToRequiredEquipments", references: [id])
   selectableEquipments Equipment[]          @relation("moveToSelectableEquipments", references: [id])
   workoutMoves         WorkoutMove[]
@@ -189,9 +192,9 @@
   id          String           @default(uuid()) @id
   name        String
   description String?
   scoreType   WorkoutScoreType
-  workouts    Workout[]
+  Workout     Workout[]
 }
 model ScheduledWorkout {
   id             String       @default(uuid()) @id
@@ -217,46 +220,46 @@
   score            Int
   log              String?
   notes            String?
   scheduledWorkout ScheduledWorkout
-  benchmark        Benchmark?
+  scoreSubmission  ScoreSubmission?
 }
 // Height in cms / weight in kgs
 model User {
-  id                           String                         @default(uuid()) @id
-  firebaseUid                  String                         @unique
-  createdAt                    DateTime                       @default(now())
-  hasOnboarded                 Boolean?                       @default(false)
-  avatarUrl                    String?
-  displayName                  String?                        @unique
-  firstname                    String?
-  lastname                     String?
-  themePreference              ThemePreference?               @default(DARK)
-  bio                          String?
-  birthdate                    DateTime?
-  gender                       Gender?
-  height                       Float?
-  weight                       Float?
-  gymBox                       String?
-  townCity                     String?
-  countryCode                  String?
-  unitSystem                   UnitSystem                     @default(METRIC)
-  subscriptionLevel            UserSubscriptionLevel          @default(FREE)
-  benchmarks                   Benchmark[]
-  challenges                   Challenge[]
-  benchmarkVideoValidations    BenchmarkVideoValidation[]
-  benchmarkVideoComments       BenchmarkVideoComment[]
-  BenchmarkVideoCommentReplies BenchmarkVideoCommentReplies[]
-  watchedChallenges            Challenge[]                    @relation("watchersToChallenges", references: [id])
-  followedBy                   User[]                         @relation("UserFollows", references: [id])
-  following                    User[]                         @relation("UserFollows", references: [id])
-  groupsWhereAdmin             Group[]                        @relation("groupToAdmins")
-  groupsWhereMember            Group[]                        @relation("groupToMembers")
-  groupsWhereCreator           Group[]                        @relation("groupToCreator")
-  moves                        Move[]
-  workouts                     Workout[]
-  scheduledWorkouts            ScheduledWorkout[]
+  id                                 String                               @default(uuid()) @id
+  firebaseUid                        String                               @unique
+  createdAt                          DateTime                             @default(now())
+  hasOnboarded                       Boolean?                             @default(false)
+  avatarUrl                          String?
+  displayName                        String?                              @unique
+  firstname                          String?
+  lastname                           String?
+  themePreference                    ThemePreference?                     @default(DARK)
+  bio                                String?
+  birthdate                          DateTime?
+  gender                             Gender?
+  height                             Float?
+  weight                             Float?
+  gymBox                             String?
+  townCity                           String?
+  countryCode                        String?
+  unitSystem                         UnitSystem                           @default(METRIC)
+  subscriptionLevel                  UserSubscriptionLevel                @default(FREE)
+  scoreSubmissions                   ScoreSubmission[]
+  challenges                         Challenge[]
+  scoreSubmissionVideoValidations    ScoreSubmissionVideoValidation[]
+  scoreSubmissionVideoComments       ScoreSubmissionVideoComment[]
+  ScoreSubmissionVideoCommentReplies ScoreSubmissionVideoCommentReplies[]
+  watchedChallenges                  Challenge[]                          @relation("watchersToChallenges", references: [id])
+  followedBy                         User[]                               @relation("UserFollows", references: [id])
+  following                          User[]                               @relation("UserFollows", references: [id])
+  groupsWhereAdmin                   Group[]                              @relation("groupToAdmins")
+  groupsWhereMember                  Group[]                              @relation("groupToMembers")
+  groupsWhereCreator                 Group[]                              @relation("groupToCreator")
+  moves                              Move[]
+  workouts                           Workout[]
+  scheduledWorkouts                  ScheduledWorkout[]
 }
 // Enums
 enum AccessScopeType {
@@ -265,8 +268,13 @@
   GROUP
   PRIVATE
 }
+enum MoveType {
+  STANDARD
+  COMPOUND
+}
+
 enum UserSubscriptionLevel {
   FREE
   PAID
 }
@@ -293,9 +301,8 @@
 // AMREPS in reps
 // TIME in seconds
 // LOAD in kgs
-// EMON in reps
 enum WorkoutScoreType {
   AMREPS
   FORTIME
   FORLOAD
```


