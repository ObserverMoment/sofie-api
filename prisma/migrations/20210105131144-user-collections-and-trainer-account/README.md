# Migration `20210105131144-user-collections-and-trainer-account`

This migration has been generated by ObserverMoment at 1/5/2021, 1:11:44 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "TrainerAccount" (
    "id" TEXT NOT NULL,
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "userId" TEXT NOT NULL,

    PRIMARY KEY ("id")
)

CREATE TABLE "UserCollection" (
    "id" TEXT NOT NULL,
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "userId" TEXT NOT NULL,
    "name" TEXT NOT NULL,
    "description" TEXT,

    PRIMARY KEY ("id")
)

CREATE TABLE "_UserCollectionToWorkout" (
    "A" TEXT NOT NULL,
    "B" TEXT NOT NULL
)

CREATE TABLE "_UserCollectionToWorkoutProgram" (
    "A" TEXT NOT NULL,
    "B" TEXT NOT NULL
)

CREATE UNIQUE INDEX "TrainerAccount_userId_unique" ON "TrainerAccount"("userId")

CREATE UNIQUE INDEX "_UserCollectionToWorkout_AB_unique" ON "_UserCollectionToWorkout"("A", "B")

CREATE INDEX "_UserCollectionToWorkout_B_index" ON "_UserCollectionToWorkout"("B")

CREATE UNIQUE INDEX "_UserCollectionToWorkoutProgram_AB_unique" ON "_UserCollectionToWorkoutProgram"("A", "B")

CREATE INDEX "_UserCollectionToWorkoutProgram_B_index" ON "_UserCollectionToWorkoutProgram"("B")

ALTER TABLE "TrainerAccount" ADD FOREIGN KEY("userId")REFERENCES "User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "UserCollection" ADD FOREIGN KEY("userId")REFERENCES "User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "_UserCollectionToWorkout" ADD FOREIGN KEY("A")REFERENCES "UserCollection"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "_UserCollectionToWorkout" ADD FOREIGN KEY("B")REFERENCES "Workout"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "_UserCollectionToWorkoutProgram" ADD FOREIGN KEY("A")REFERENCES "UserCollection"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "_UserCollectionToWorkoutProgram" ADD FOREIGN KEY("B")REFERENCES "WorkoutProgram"("id") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20201230162000-move-archived..20210105131144-user-collections-and-trainer-account
--- datamodel.dml
+++ datamodel.dml
@@ -6,9 +6,9 @@
 }
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 model BodyArea {
   id                 String              @id @default(uuid())
@@ -214,8 +214,15 @@
   gymProfile      GymProfile?    @relation(fields: [gymProfileId], references: [id])
   gymProfileId    String?
 }
+model TrainerAccount {
+  id        String   @id @default(uuid())
+  createdAt DateTime @default(now())
+  user      User     @relation(fields: [userId], references: [id])
+  userId    String
+}
+
 // Height in cms / weight in kgs
 model User {
   id                       String                    @id @default(uuid())
   firebaseUid              String                    @unique
@@ -266,8 +273,12 @@
   /// @onDelete(CASCADE)
   progressJournals         ProgressJournal[]
   /// @onDelete(CASCADE)
   userBenchmarks           UserBenchmark[]
+  /// @onDelete(CASCADE)
+  collections              UserCollection[]
+  /// @onDelete(CASCADE)
+  trainerAccount           TrainerAccount?
 }
 model UserBenchmark {
   id           String               @id @default(uuid())
@@ -298,8 +309,19 @@
   userBenchmark   UserBenchmark @relation(fields: [userBenchmarkId], references: [id])
   userBenchmarkId String
 }
+model UserCollection {
+  id              String           @id @default(uuid())
+  createdAt       DateTime         @default(now())
+  owner           User             @relation(fields: [userId], references: [id])
+  userId          String
+  name            String
+  description     String?
+  workouts        Workout[]
+  workoutPrograms WorkoutProgram[]
+}
+
 model Workout {
   id                String                  @id @default(uuid())
   createdAt         DateTime                @default(now())
   createdBy         User?                   @relation(fields: [createdById], references: [id])
@@ -325,8 +347,9 @@
   workoutLogs       LoggedWorkout[]
   /// @onDelete(CASCADE)
   likes             LikedWorkout[]
   workoutPrograms   WorkoutProgramWorkout[]
+  userCollections   UserCollection[]
 }
 model WorkoutGoal {
   id                  String           @id @default(uuid())
@@ -377,8 +400,9 @@
   workoutProgramWorkouts WorkoutProgramWorkout[]
   /// @onDelete(CASCADE)
   workoutProgramReviews  WorkoutProgramReview[]
   likes                  LikedWorkoutProgram[]
+  userCollections        UserCollection[]
 }
 // A single user enrolled in a plan a single time
 // A single user can also enrol multiple times
```


