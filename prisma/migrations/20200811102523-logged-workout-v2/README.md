# Migration `20200811102523-logged-workout-v2`

This migration has been generated by ObserverMoment at 8/11/2020, 11:25:23 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE "public"."LoggedWorkout" DROP CONSTRAINT "LoggedWorkout_workoutId_fkey"

ALTER TABLE "public"."LoggedWorkout" DROP COLUMN "workoutId",
ADD COLUMN "name" text  NOT NULL ,
ADD COLUMN "summary" text   ,
ADD COLUMN "description" text   ,
ADD COLUMN "videoThumbUrl" text   ,
ADD COLUMN "duration" integer   ,
ADD COLUMN "difficultyLevel" "DifficultyLevel" NOT NULL DEFAULT E'ONE',
ADD COLUMN "workoutTypeId" text  NOT NULL ;

ALTER TABLE "public"."WorkoutSection" ADD COLUMN "loggedWorkoutId" text   ;

ALTER TABLE "public"."LoggedWorkout" ADD FOREIGN KEY ("workoutTypeId")REFERENCES "public"."WorkoutType"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."WorkoutSection" ADD FOREIGN KEY ("loggedWorkoutId")REFERENCES "public"."LoggedWorkout"("id") ON DELETE SET NULL ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200810193429-logged-workout-workout..20200811102523-logged-workout-v2
--- datamodel.dml
+++ datamodel.dml
@@ -6,9 +6,9 @@
 }
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 model ScoreSubmission {
   id                     String                @default(uuid()) @id
@@ -129,37 +129,37 @@
   workoutMoves         WorkoutMove[]
 }
 model WorkoutType {
-  id          String           @default(uuid()) @id
-  name        String
-  description String?
-  scoreType   WorkoutScoreType
-  Workout     Workout[]
+  id            String           @default(uuid()) @id
+  name          String
+  description   String?
+  scoreType     WorkoutScoreType
+  Workout       Workout[]
+  LoggedWorkout LoggedWorkout[]
 }
 model Workout {
-  id                     String             @default(uuid()) @id
-  createdAt              DateTime           @default(now())
-  createdBy              User?              @relation(fields: [createdById], references: [id])
-  createdById            String?
-  name                   String
-  summary                String?
-  description            String?
-  demoVideoUrl           String?
-  demoVideoThumbUrl      String?
-  youtubeVideoUrl        String?
-  spotifyAudio           String?
-  imageUrl               String?
-  timecap                Int?
-  difficultyLevel        DifficultyLevel    @default(ONE)
-  scope                  AccessScopeType    @default(PRIVATE)
-  workoutType            WorkoutType        @relation(fields: [workoutTypeId], references: [id])
-  workoutTypeId          String
-  workoutSections        WorkoutSection[]
-  scheduledWorkouts      ScheduledWorkout[]
-  workoutDataForLogs     LoggedWorkout[]    @relation("workoutData")
-  originalWorkoutForLogs LoggedWorkout[]
+  id                String             @default(uuid()) @id
+  createdAt         DateTime           @default(now())
+  createdBy         User?              @relation(fields: [createdById], references: [id])
+  createdById       String?
+  name              String
+  summary           String?
+  description       String?
+  demoVideoUrl      String?
+  demoVideoThumbUrl String?
+  youtubeVideoUrl   String?
+  spotifyAudio      String?
+  imageUrl          String?
+  timecap           Int?
+  difficultyLevel   DifficultyLevel    @default(ONE)
+  scope             AccessScopeType    @default(PRIVATE)
+  workoutType       WorkoutType        @relation(fields: [workoutTypeId], references: [id])
+  workoutTypeId     String
+  workoutSections   WorkoutSection[]
+  scheduledWorkouts ScheduledWorkout[]
+  workoutLogs       LoggedWorkout[]
 }
 model WorkoutSection {
   id               String            @default(uuid()) @id
@@ -171,8 +171,10 @@
   workout          Workout           @relation(fields: [workoutId], references: [id])
   workoutId        String
   workoutMoves     WorkoutMove[]
   roundAdjustRules RoundAdjustRule[]
+  LoggedWorkout    LoggedWorkout?    @relation(fields: [loggedWorkoutId], references: [id])
+  loggedWorkoutId  String?
 }
 // Every {roundFrequency} rounds {operator} reps by {amount}
 // Eg. Every 3 rounds INCREASE reps by 10 (for all workout moves within the section)
@@ -231,17 +233,24 @@
 // Data from a completed workout. Also inlcudes relation to the 'original' workout
 model LoggedWorkout {
   id                 String            @default(uuid()) @id
+  name               String
+  summary            String?
+  description        String?
   createdAt          DateTime          @default(now())
   completedOn        DateTime
   completedBy        User              @relation(fields: [completedById], references: [id])
   completedById      String
   notes              String?
   videoUrl           String?
+  videoThumbUrl      String?
   imageUrl           String?
-  workout            Workout           @relation("workoutData", fields: [workoutId], references: [id])
-  workoutId          String
+  duration           Int?
+  difficultyLevel    DifficultyLevel   @default(ONE)
+  workoutType        WorkoutType       @relation(fields: [workoutTypeId], references: [id])
+  workoutTypeId      String
+  workoutSections    WorkoutSection[]
   originalWorkout    Workout?          @relation(fields: [originalWorkoutId], references: [id])
   originalWorkoutId  String?
   scheduledWorkout   ScheduledWorkout?
   scheduledWorkoutId String?
```


