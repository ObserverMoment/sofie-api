# Migration `20201110095519-reset`

This migration has been generated by ObserverMoment at 11/10/2020, 9:55:19 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "public"."FrequencyPeriod" AS ENUM ('DAY', 'TWODAYS', 'WEEK', 'TWOWEEKS', 'MONTH')

Begin;
CREATE TYPE "public"."AccessScopeType_new" AS ENUM ('OFFICIAL', 'PUBLIC', 'GROUP', 'PRIVATE');
ALTER TABLE "public"."Workout" ALTER COLUMN "scope" TYPE "AccessScopeType_new" USING ("scope"::text::"AccessScopeType_new");
ALTER TABLE "public"."WorkoutProgram" ALTER COLUMN "scope" TYPE "AccessScopeType_new" USING ("scope"::text::"AccessScopeType_new");
ALTER TYPE "AccessScopeType" RENAME TO "AccessScopeType_old";
ALTER TYPE "AccessScopeType_new" RENAME TO "AccessScopeType";
DROP TYPE "AccessScopeType_old";
Commit

Begin;
CREATE TYPE "public"."MoveType_new" AS ENUM ('STANDARD', 'CUSTOM');
ALTER TABLE "public"."Move" ALTER COLUMN "type" TYPE "MoveType_new" USING ("type"::text::"MoveType_new");
ALTER TYPE "MoveType" RENAME TO "MoveType_old";
ALTER TYPE "MoveType_new" RENAME TO "MoveType";
DROP TYPE "MoveType_old";
Commit

ALTER TABLE "public"."_compoundMoves" DROP CONSTRAINT "_compoundMoves_A_fkey"

ALTER TABLE "public"."_compoundMoves" DROP CONSTRAINT "_compoundMoves_B_fkey"

ALTER TABLE "public"."Equipment" ADD COLUMN "loadAdjustable" boolean   NOT NULL DEFAULT true

ALTER TABLE "public"."GymProfile" ADD COLUMN "bodyweightOnly" boolean   NOT NULL DEFAULT false

ALTER TABLE "public"."LoggedWorkout" DROP COLUMN "difficultyLevel",
DROP COLUMN "originalWorkoutScope",
ADD COLUMN "workoutProgramEnrolmentId" text   

ALTER TABLE "public"."Move" DROP COLUMN "scope",
DROP COLUMN "moveType",
ADD COLUMN "type" "MoveType"  NOT NULL DEFAULT E'STANDARD'

ALTER TABLE "public"."ScheduledWorkout" ALTER COLUMN "workoutId" SET NOT NULL

ALTER TABLE "public"."User" ALTER COLUMN "hasOnboarded" SET NOT NULL,
ALTER COLUMN "themePreference" SET NOT NULL

ALTER TABLE "public"."Workout" ALTER COLUMN "difficultyLevel" SET DEFAULT 50,
ALTER COLUMN "difficultyLevel" SET DATA TYPE integer 

ALTER TABLE "public"."WorkoutType" ADD COLUMN "placeholderImageUrl" text   NOT NULL ,
ALTER COLUMN "description" SET NOT NULL

DROP TYPE "DifficultyLevel"

CREATE TABLE "public"."MoveProfile" (
"id" text   NOT NULL ,
"userId" text   NOT NULL ,
"name" text   NOT NULL ,
"description" text   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."WorkoutGoal" (
"id" text   NOT NULL ,
"name" text   NOT NULL ,
"description" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."WorkoutProgram" (
"id" text   NOT NULL ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"name" text   NOT NULL ,
"description" text   NOT NULL ,
"imageUrl" text   ,
"videoUrl" text   ,
"videoThumbUrl" text   ,
"scope" "AccessScopeType"  NOT NULL DEFAULT E'PRIVATE',
"createdById" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."WorkoutProgramEnrolment" (
"id" text   NOT NULL ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"startDate" timestamp(3)   DEFAULT CURRENT_TIMESTAMP,
"workoutProgramId" text   NOT NULL ,
"userId" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."WorkoutProgramReview" (
"id" text   NOT NULL ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"score" Decimal(65,30)   NOT NULL ,
"comment" text   ,
"workoutProgramId" text   NOT NULL ,
"userId" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."WorkoutProgramWorkout" (
"id" text   NOT NULL ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"dayNumber" Decimal(65,30)   NOT NULL ,
"notes" text   ,
"workoutProgramId" text   NOT NULL ,
"workoutId" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."_EquipmentToGymProfile" (
"A" text   NOT NULL ,
"B" text   NOT NULL 
)

CREATE TABLE "public"."_requiredMoves" (
"A" text   NOT NULL ,
"B" text   NOT NULL 
)

CREATE TABLE "public"."_excludedMoves" (
"A" text   NOT NULL ,
"B" text   NOT NULL 
)

CREATE TABLE "public"."_WorkoutGoalToWorkoutProgram" (
"A" text   NOT NULL ,
"B" text   NOT NULL 
)

DROP TABLE "public"."_compoundMoves"

CREATE UNIQUE INDEX "_EquipmentToGymProfile_AB_unique" ON "public"."_EquipmentToGymProfile"("A", "B")

CREATE INDEX "_EquipmentToGymProfile_B_index" ON "public"."_EquipmentToGymProfile"("B")

CREATE UNIQUE INDEX "_requiredMoves_AB_unique" ON "public"."_requiredMoves"("A", "B")

CREATE INDEX "_requiredMoves_B_index" ON "public"."_requiredMoves"("B")

CREATE UNIQUE INDEX "_excludedMoves_AB_unique" ON "public"."_excludedMoves"("A", "B")

CREATE INDEX "_excludedMoves_B_index" ON "public"."_excludedMoves"("B")

CREATE UNIQUE INDEX "_WorkoutGoalToWorkoutProgram_AB_unique" ON "public"."_WorkoutGoalToWorkoutProgram"("A", "B")

CREATE INDEX "_WorkoutGoalToWorkoutProgram_B_index" ON "public"."_WorkoutGoalToWorkoutProgram"("B")

ALTER TABLE "public"."MoveProfile" ADD FOREIGN KEY("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."WorkoutProgram" ADD FOREIGN KEY("createdById")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."WorkoutProgramEnrolment" ADD FOREIGN KEY("workoutProgramId")REFERENCES "public"."WorkoutProgram"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."WorkoutProgramEnrolment" ADD FOREIGN KEY("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."WorkoutProgramReview" ADD FOREIGN KEY("workoutProgramId")REFERENCES "public"."WorkoutProgram"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."WorkoutProgramReview" ADD FOREIGN KEY("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."WorkoutProgramWorkout" ADD FOREIGN KEY("workoutProgramId")REFERENCES "public"."WorkoutProgram"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."WorkoutProgramWorkout" ADD FOREIGN KEY("workoutId")REFERENCES "public"."Workout"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_EquipmentToGymProfile" ADD FOREIGN KEY("A")REFERENCES "public"."Equipment"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_EquipmentToGymProfile" ADD FOREIGN KEY("B")REFERENCES "public"."GymProfile"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_requiredMoves" ADD FOREIGN KEY("A")REFERENCES "public"."Move"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_requiredMoves" ADD FOREIGN KEY("B")REFERENCES "public"."MoveProfile"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_excludedMoves" ADD FOREIGN KEY("A")REFERENCES "public"."Move"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_excludedMoves" ADD FOREIGN KEY("B")REFERENCES "public"."MoveProfile"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_WorkoutGoalToWorkoutProgram" ADD FOREIGN KEY("A")REFERENCES "public"."WorkoutGoal"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_WorkoutGoalToWorkoutProgram" ADD FOREIGN KEY("B")REFERENCES "public"."WorkoutProgram"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."LoggedWorkout" ADD FOREIGN KEY("workoutProgramEnrolmentId")REFERENCES "public"."WorkoutProgramEnrolment"("id") ON DELETE SET NULL ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20201110095217-reset..20201110095519-reset
--- datamodel.dml
+++ datamodel.dml
@@ -6,9 +6,9 @@
 }
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 model Equipment {
   id                 String        @id @default(uuid())
@@ -305,8 +305,9 @@
 // Enums
 enum AccessScopeType {
   OFFICIAL
   PUBLIC
+  GROUP
   PRIVATE
 }
 enum DistanceUnit {
```


